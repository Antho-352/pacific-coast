---
deployment:
  tasks:
    # DÃ©finition des variables
    - export DEPLOYPATH=/home/hondapacificcoas/public_html/
    - export REPO_PATH=/home/hondapacificcoas/repositories/honda-pacific-coast/
    
    # Log de dÃ©but
    - echo "[$(date)] ðŸš€ DÃ©marrage du dÃ©ploiement automatique" >> /home/hondapacificcoas/deploy.log
    
    # Ã‰tape 1 : Installation des dÃ©pendances
    - cd $REPO_PATH && /opt/cpanel/ea-nodejs20/bin/npm install >> /home/hondapacificcoas/deploy.log 2>&1
    
    # Ã‰tape 2 : Build
    - cd $REPO_PATH && /opt/cpanel/ea-nodejs20/bin/npm run build >> /home/hondapacificcoas/deploy.log 2>&1
    
    # Ã‰tape 3 : DÃ©ploiement avec rsync (EXCLUT /magazine et WordPress)
    - echo "[$(date)] ðŸ“ DÃ©ploiement sÃ©curisÃ© sans toucher /magazine..." >> /home/hondapacificcoas/deploy.log
    - rsync -av --delete --exclude='magazine/' --exclude='wp-admin/' --exclude='wp-content/' --exclude='wp-includes/' --exclude='wp-*.php' --exclude='xmlrpc.php' --exclude='index.php' $REPO_PATH/dist/ $DEPLOYPATH >> /home/hondapacificcoas/deploy.log 2>&1
    
    # Log de fin
    - echo "[$(date)] âœ… DÃ©ploiement terminÃ© (WordPress prÃ©servÃ©)" >> /home/hondapacificcoas/deploy.log
