---
/**
 * Gallery Section - PC800.fr
 * Design premium, sans emojis, visuels cohérents
 */

// Données des images (placeholder - à remplacer par des photos PC800 réelles)
const galleryImages = [
  {
    id: 1,
    src: "https://images.unsplash.com/photo-1558981403-c5f9899a28bc?w=800&q=80",
    alt: "Honda PC800 Pacific Coast - Vue de profil montrant la ligne de carénage intégrale",
    category: "exterieur",
    title: "Profil élégant"
  },
  {
    id: 2,
    src: "https://images.unsplash.com/photo-1449426468159-d96dbf08f19f?w=800&q=80",
    alt: "Moto touring sur route côtière, ambiance voyage",
    category: "balade",
    title: "Sur la route"
  },
  {
    id: 3,
    src: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&q=80",
    alt: "Détail moteur V-Twin 52 degrés de la PC800",
    category: "details",
    title: "Moteur V-Twin"
  },
  {
    id: 4,
    src: "https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=800&q=80",
    alt: "Coffre arrière intégré de 140 litres de la PC800",
    category: "details",
    title: "Coffre 140L"
  },
  {
    id: 5,
    src: "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?w=800&q=80",
    alt: "PC800 en balade sur route de campagne",
    category: "balade",
    title: "Week-end touring"
  },
  {
    id: 6,
    src: "https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=800&q=80",
    alt: "Tableau de bord et instrumentation vintage de la PC800",
    category: "details",
    title: "Tableau de bord"
  },
  {
    id: 7,
    src: "https://images.unsplash.com/photo-1558980664-10e7170b5df9?w=800&q=80",
    alt: "Vue avant de la Honda PC800 Pacific Coast",
    category: "exterieur",
    title: "Face avant"
  },
  {
    id: 8,
    src: "https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?w=800&q=80",
    alt: "Rassemblement de motos touring",
    category: "balade",
    title: "Rassemblement"
  },
  {
    id: 9,
    src: "https://images.unsplash.com/photo-1547549082-6bc09f2049ae?w=800&q=80",
    alt: "Phare caractéristique et détails du carénage",
    category: "details",
    title: "Phare et carénage"
  }
];

const categories = [
  { id: 'all', label: 'Toutes' },
  { id: 'exterieur', label: 'Extérieur' },
  { id: 'details', label: 'Détails' },
  { id: 'balade', label: 'En balade' },
];
---

<section id="galerie" class="section bg-metal-100">
  <div class="container">
    <!-- Header -->
    <div class="section-header text-center">
      <span class="section-header__label">Galerie</span>
      <h2 class="section-header__title mx-auto">La PC800 en images</h2>
      <p class="section-header__intro mx-auto">
        Découvrez cette moto culte sous tous les angles. Des détails techniques aux plus belles routes.
      </p>
    </div>

    <!-- Filtres -->
    <div class="flex flex-wrap justify-center gap-2 mb-10" id="gallery-filters">
      {categories.map((cat) => (
        <button
          type="button"
          class={`gallery-filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 ${
            cat.id === 'all' 
              ? 'bg-gray-900 text-white' 
              : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'
          }`}
          data-category={cat.id}
        >
          {cat.label}
        </button>
      ))}
    </div>

    <!-- Grid -->
    <div class="gallery-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {galleryImages.map((image, index) => (
        <div 
          class="gallery-item group relative overflow-hidden rounded-xl cursor-pointer aspect-[4/3] bg-gray-200"
          data-category={image.category}
          data-index={index}
        >
          <img 
            src={image.src}
            alt={image.alt}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            loading="lazy"
          />
          
          <!-- Overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-5">
            <span class="text-red-400 text-xs font-semibold uppercase tracking-wider mb-1">
              {categories.find(c => c.id === image.category)?.label}
            </span>
            <h3 class="text-white text-lg font-semibold">{image.title}</h3>
          </div>
          
          <!-- Zoom icon -->
          <div class="absolute top-4 right-4 w-8 h-8 bg-white/90 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
            <svg class="w-4 h-4 text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
            </svg>
          </div>
        </div>
      ))}
    </div>

    <!-- CTA -->
    <div class="text-center mt-12">
      <p class="text-gray-500 mb-4">Vous avez des photos de votre PC800 ?</p>
      <a href="mailto:contact@pc800.fr?subject=Photo%20PC800" class="inline-flex items-center gap-2 px-6 py-3 bg-red-700 hover:bg-red-800 text-white font-medium rounded-lg transition-colors">
        Envoyer vos photos
      </a>
    </div>
  </div>
</section>

<!-- Lightbox -->
<div id="lightbox" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
  <div class="absolute inset-0 bg-black/95 backdrop-blur-sm" id="lightbox-backdrop"></div>
  
  <div class="relative h-full flex items-center justify-center p-4">
    <button 
      type="button" 
      id="lightbox-close"
      class="absolute top-4 right-4 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors z-10"
      aria-label="Fermer"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
    
    <button 
      type="button"
      id="lightbox-prev"
      class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors z-10 hidden md:flex"
      aria-label="Image précédente"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <div class="relative max-w-5xl max-h-[85vh]">
      <img 
        id="lightbox-image"
        src=""
        alt=""
        class="max-w-full max-h-[85vh] object-contain rounded-lg"
      />
      <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-6 rounded-b-lg">
        <h3 id="lightbox-title" class="text-white text-lg font-semibold"></h3>
        <p id="lightbox-category" class="text-red-400 text-sm"></p>
      </div>
    </div>
    
    <button 
      type="button"
      id="lightbox-next"
      class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors z-10 hidden md:flex"
      aria-label="Image suivante"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
  
  <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white/60 text-sm">
    <span id="lightbox-counter">1</span> / <span id="lightbox-total">9</span>
  </div>
</div>

<style>
  .section { padding: 4rem 0; }
  @media (min-width: 768px) { .section { padding: 6rem 0; } }
  
  .container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .section-header {
    margin-bottom: 3rem;
  }
  
  .section-header__label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #C41E3A;
    margin-bottom: 0.5rem;
    display: block;
  }
  
  .section-header__title {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 700;
    color: #111827;
    line-height: 1.2;
    margin-bottom: 1rem;
  }
  
  .section-header__intro {
    font-size: 1.125rem;
    color: #4B5563;
    line-height: 1.6;
    max-width: 600px;
  }
  
  .bg-metal-100 { background-color: #F5F5F4; }
  
  .gallery-item {
    transition: all 0.4s ease;
  }
  
  .gallery-item.hidden {
    display: none;
  }
  
  .gallery-item.fade-in {
    animation: fadeIn 0.4s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
</style>

<script define:vars={{ galleryImages }}>
  const images = galleryImages;
  let currentIndex = 0;

  const filterBtns = document.querySelectorAll('.gallery-filter-btn');
  const galleryItems = document.querySelectorAll('.gallery-item');
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  const lightboxTitle = document.getElementById('lightbox-title');
  const lightboxCategory = document.getElementById('lightbox-category');
  const lightboxCounter = document.getElementById('lightbox-counter');
  const lightboxTotal = document.getElementById('lightbox-total');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.dataset.category;
      
      filterBtns.forEach(b => {
        b.classList.remove('bg-gray-900', 'text-white');
        b.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
      });
      btn.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
      btn.classList.add('bg-gray-900', 'text-white');
      
      galleryItems.forEach((item) => {
        const itemCategory = item.dataset.category;
        if (category === 'all' || itemCategory === category) {
          item.classList.remove('hidden');
          item.classList.add('fade-in');
          setTimeout(() => item.classList.remove('fade-in'), 400);
        } else {
          item.classList.add('hidden');
        }
      });
    });
  });

  galleryItems.forEach((item, index) => {
    item.addEventListener('click', () => {
      const imgId = parseInt(item.dataset.index);
      openLightbox(imgId);
    });
  });

  function openLightbox(index) {
    currentIndex = index;
    updateLightbox();
    lightbox.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    lightbox.classList.add('hidden');
    document.body.style.overflow = '';
  }

  function updateLightbox() {
    const img = images[currentIndex];
    lightboxImage.src = img.src;
    lightboxImage.alt = img.alt;
    lightboxTitle.textContent = img.title;
    
    const categoryLabels = {
      'exterieur': 'Extérieur',
      'details': 'Détails techniques',
      'balade': 'En balade'
    };
    lightboxCategory.textContent = categoryLabels[img.category] || img.category;
    lightboxCounter.textContent = currentIndex + 1;
    lightboxTotal.textContent = images.length;
  }

  function nextImage() {
    currentIndex = (currentIndex + 1) % images.length;
    updateLightbox();
  }

  function prevImage() {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    updateLightbox();
  }

  document.getElementById('lightbox-close')?.addEventListener('click', closeLightbox);
  document.getElementById('lightbox-backdrop')?.addEventListener('click', closeLightbox);
  document.getElementById('lightbox-next')?.addEventListener('click', (e) => { e.stopPropagation(); nextImage(); });
  document.getElementById('lightbox-prev')?.addEventListener('click', (e) => { e.stopPropagation(); prevImage(); });

  document.addEventListener('keydown', (e) => {
    if (lightbox.classList.contains('hidden')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowRight') nextImage();
    if (e.key === 'ArrowLeft') prevImage();
  });

  let touchStartX = 0;
  lightbox?.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; });
  lightbox?.addEventListener('touchend', (e) => {
    const diff = touchStartX - e.changedTouches[0].screenX;
    if (Math.abs(diff) > 50) diff > 0 ? nextImage() : prevImage();
  });
</script>